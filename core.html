<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>DIGIY HUB â€” ğŸ” Recherche PRO (Pack prÃªt GitHub Pages)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#0A0E1A">
  <meta name="description" content="DIGIY HUB â€” Recherche PRO avec carte NDIMBAL (Leaflet + Supabase).">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800;900&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <!-- SearchPro CSS -->
  <link rel="stylesheet" href="assets/css/searchpro.css"/>

  <style>
    :root{
      --bg:#020617; --bg2:#0B1120; --card:rgba(2,6,23,.55);
      --line:rgba(148,163,184,.22);
      --text:#e5e7eb; --muted:rgba(229,231,235,.72);
      --gold:#facc15; --orange:#f97316; --cyan:#22d3ee;
      --radius:18px;
      --shadow:0 14px 40px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--text);
      font-family:Manrope,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1000px 520px at 18% -10%, rgba(249,115,22,.22), transparent 60%),
        radial-gradient(980px 540px at 92% 0%, rgba(34,211,238,.18), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      min-height:100vh;
    }
    a{color:inherit; text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:18px}
    header{
      border:1px solid var(--line);
      background:rgba(2,6,23,.55);
      border-radius:24px;
      box-shadow:var(--shadow);
      padding:14px 14px;
      position:sticky; top:10px; z-index:10;
      backdrop-filter: blur(10px);
    }
    .header-content{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{
      width:44px;height:44px;border-radius:16px;
      display:grid;place-items:center;
      font-family:Outfit,sans-serif;font-weight:950;
      color:#111827;
      background:linear-gradient(135deg, var(--gold), var(--orange));
      box-shadow:0 12px 26px rgba(250,204,21,.22);
    }
    .titles .t1{font-family:Outfit,sans-serif;font-weight:950;letter-spacing:.08em;text-transform:uppercase}
    .titles .t2{font-size:12px;color:var(--muted);font-weight:800;margin-top:2px}
    .right{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:flex-end}

    .btn{
      border:1px solid rgba(148,163,184,.28);
      background:rgba(2,6,23,.35);
      color:var(--text);
      padding:10px 14px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      font-family:Outfit,sans-serif;
      letter-spacing:.03em;
      transition:transform .12s ease, border-color .12s ease, background .12s ease;
      display:inline-flex;align-items:center;gap:8px;
    }
    .btn:hover{transform:translateY(-1px);border-color:rgba(249,115,22,.55);background:rgba(249,115,22,.12)}
    .btn:active{transform:translateY(0)}
    .btn-primary{
      background:linear-gradient(135deg, rgba(250,204,21,.95), rgba(249,115,22,.92));
      color:#111827;
      border:none;
    }
    .btn-primary:hover{background:linear-gradient(135deg, rgba(250,204,21,1), rgba(249,115,22,1))}
    .btn-secondary{background:rgba(2,6,23,.35)}

    .card{
      margin-top:16px;
      border:1px solid var(--line);
      background:rgba(2,6,23,.55);
      border-radius:24px;
      box-shadow:var(--shadow);
      padding:16px;
    }
    .card h1{
      margin:0 0 6px;
      font-family:Outfit,sans-serif;
      font-weight:950;
      letter-spacing:.06em;
      text-transform:uppercase;
      font-size:1.05rem;
    }
    .card p{margin:0;color:var(--muted);font-weight:700;line-height:1.45}
    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:14px;margin-top:14px}
    @media(max-width:900px){.grid{grid-template-columns:1fr} header{position:static}}

    /* ===== Modal base styles (overlay + card) ===== */
    .digiy-modal-overlay{
      display:none;
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      z-index:9999;
      padding:16px;
    }
    .digiy-modal{max-width:1040px;margin:0 auto;}
    .digiy-modal-card{
      border:1px solid rgba(148,163,184,.28);
      background:rgba(2,6,23,.92);
      border-radius:24px;
      box-shadow:0 24px 70px rgba(0,0,0,.65);
      padding:16px;
      backdrop-filter: blur(10px);
    }

    .digiy-input, .digiy-select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,.28);
      background:rgba(15,23,42,.55);
      color:var(--text);
      outline:none;
      font-weight:800;
      font-family:Manrope,sans-serif;
    }
    .digiy-input:focus, .digiy-select:focus{
      border-color:rgba(249,115,22,.65);
      box-shadow:0 0 0 3px rgba(249,115,22,.18);
    }

    .digiy-results-grid{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:12px;
    }
    @media(max-width:900px){.digiy-results-grid{grid-template-columns:1fr}}

    .digiy-result{
      border:1px solid rgba(148,163,184,.22);
      background:rgba(15,23,42,.55);
      border-radius:18px;
      padding:12px;
      cursor:pointer;
      transition:transform .12s ease, border-color .12s ease, background .12s ease;
    }
    .digiy-result:hover{
      transform:translateY(-1px);
      border-color:rgba(249,115,22,.55);
      background:rgba(249,115,22,.10);
    }
    .digiy-pill{
      display:inline-flex;align-items:center;gap:6px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.22);
      background:rgba(2,6,23,.35);
      font-weight:900;
      color:rgba(229,231,235,.9);
    }
  </style>
</head>

<body>
  <div class="wrap">

    <header>
      <div class="header-content">
        <div class="brand">
          <a href="core.html" class="btn btn-secondary" title="Retour DIGIY HUB">â† HUB</a>
          <div class="logo">â™¾ï¸</div>
          <div class="titles">
            <div class="t1">DIGIY â€¢ NDIMBAL</div>
            <div class="t2">Recherche PRO â€” Carte + Liste â€¢ 0% commission</div>
          </div>
        </div>

        <div class="right">
          <button id="openSearchPro" class="btn btn-primary" type="button">
            ğŸ” Rechercher un PRO
          </button>
        </div>
      </div>
    </header>

    <div class="card">
      <h1>Pack prÃªt GitHub Pages</h1>
      <p>
        Clique sur <b>â€œğŸ” Rechercher un PROâ€</b> â†’ modal Search PRO V3 avec carte Leaflet.
        DonnÃ©es zones SÃ©nÃ©gal + base business intÃ©grÃ©es. Supabase dÃ©jÃ  branchÃ©.
      </p>
      <div class="grid">
        <div class="card" style="margin:0;">
          <h1>âœ… Ce qui est dedans</h1>
          <p>
            â€¢ Modal Search PRO V3<br>
            â€¢ Carte interactive + markers<br>
            â€¢ Suggestions rapides<br>
            â€¢ Filtres zones / ville / quartier / module / rayon<br>
            â€¢ RPC Supabase (fallback inclus)
          </p>
        </div>
        <div class="card" style="margin:0;">
          <h1>âš ï¸ Ã€ faire cÃ´tÃ© Supabase</h1>
          <p>
            CrÃ©er la RPC <b>search_pros_v3</b> (sinon le fallback tourne).<br>
            Table publique <b>pros_public</b> utilisÃ©e en secours.
          </p>
        </div>
      </div>
    </div>

  </div>

  <!-- =========================
     ğŸ” MODAL SEARCH PRO V3
  ========================== -->
  <!-- =========================
   MODAL SEARCH PRO V3 â€” CARTE INTERACTIVE
========================= -->
<div id="searchProModal" class="digiy-modal-overlay" aria-hidden="true">
  <div class="digiy-modal" role="dialog" aria-modal="true" aria-label="Recherche PRO DIGIY">
    <div class="digiy-modal-card">

      <!-- Header -->
      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:16px;">
        <div style="font-family:Outfit,sans-serif; font-weight:950; letter-spacing:.06em; text-transform:uppercase; font-size:1.1rem;">
          ğŸ” Recherche PRO â€” MÃ©tiers DIGIY
        </div>
        <button id="closeSearchPro" class="btn btn-secondary" type="button" style="padding:.6rem 1.1rem;font-size:.85rem;">
          âœ– Fermer
        </button>
      </div>

      <!-- Zone de recherche principale -->
      <div style="background:rgba(249,115,22,0.08); border:1px solid rgba(249,115,22,0.35); border-radius:16px; padding:14px; margin-bottom:14px;">
        
        <!-- Barre de recherche unifiÃ©e -->
        <div style="position:relative; margin-bottom:10px;">
          <input 
            id="sp_q" 
            class="digiy-input" 
            placeholder='ğŸ” Nom, ville, quartier, mÃ©tier... (ex: "fatou plateau resto")' 
            style="padding-left:40px; font-size:1rem; font-weight:700;"
            autocomplete="off"
          />
          <div style="position:absolute; left:14px; top:50%; transform:translateY(-50%); font-size:1.3rem;">
            ğŸ”
          </div>
        </div>

        <!-- Bouton filtres + GÃ©ostatus -->
        <div style="display:flex; gap:8px; align-items:center; margin-bottom:10px;">
          <button id="toggleFilters" type="button" style="
            border:none; background:rgba(15,23,42,0.5); color:#cbd5e1;
            padding:6px 12px; border-radius:999px; font-size:0.8rem; font-weight:800;
            cursor:pointer; display:flex; align-items:center; gap:6px;">
            <span id="filterIcon">â–¼</span> Filtres avancÃ©s
          </button>
          
          <div id="geoStatus" style="font-size:0.75rem; color:#cbd5e1; font-weight:650;"></div>
        </div>

        <!-- Filtres avancÃ©s (masquÃ©s par dÃ©faut) -->
        <div id="advancedFilters" style="display:none; margin-top:10px;">
          
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:10px;">
            
            <!-- SÃ©lecteur de zone -->
            <select id="sp_zone" class="digiy-select" style="font-size:0.9rem;">
              <option value="" selected>ğŸ“ Toutes les zones</option>
              <option value="aeroports">âœˆï¸ AÃ©roports</option>
              <option value="saly_petite_cote">ğŸ–ï¸ Saly & Petite CÃ´te</option>
              <option value="mbour_joal">ğŸŸ Mbour & Joal</option>
              <option value="dakar_centre">ğŸ™ï¸ Dakar Centre</option>
              <option value="dakar_banlieue">ğŸ˜ï¸ Dakar Banlieue</option>
              <option value="thies">ğŸ­ ThiÃ¨s</option>
              <option value="saint_louis">ğŸ›ï¸ Saint-Louis</option>
              <option value="autres_villes">ğŸ™ï¸ Autres villes</option>
            </select>

            <!-- Ville spÃ©cifique -->
            <input id="sp_city" class="digiy-input" placeholder="ğŸ™ï¸ Ville prÃ©cise" style="font-size:0.9rem;"/>
            
          </div>

          <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px;">
            
            <!-- Quartier -->
            <input id="sp_quartier" class="digiy-input" placeholder="ğŸ“ Quartier" style="font-size:0.9rem;"/>
            
            <!-- Module -->
            <select id="sp_module" class="digiy-select" style="font-size:0.9rem;">
              <option value="all" selected>ğŸ¦… Tous mÃ©tiers</option>
              <option value="resto">ğŸ½ï¸ Resto</option>
              <option value="loc">ğŸ  Loc</option>
              <option value="chauffeur">ğŸš— Chauffeur</option>
              <option value="market">ğŸ›ï¸ Boutique</option>
              <option value="build">ğŸ—ï¸ Artisan</option>
              <option value="job">ğŸ’¼ Jobs</option>
              <option value="fret">ğŸšš Fret</option>
            </select>

            <!-- Rayon -->
            <select id="sp_radius" class="digiy-select" style="font-size:0.9rem;">
              <option value="5">ğŸ“ 5 km</option>
              <option value="10">ğŸ“ 10 km</option>
              <option value="25" selected>ğŸ“ 25 km</option>
              <option value="50">ğŸ“ 50 km</option>
              <option value="999">ğŸŒ Partout</option>
            </select>

          </div>

        </div>

      </div>

      <!-- Bouton recherche -->
      <button id="sp_btn" class="btn btn-primary" type="button" style="width:100%; padding:1rem; font-size:1rem; margin-bottom:12px;">
        ğŸ” CHERCHER
      </button>

      <!-- Suggestions rapides -->
      <div id="quickSuggestions" style="display:flex; flex-wrap:wrap; gap:6px; margin-bottom:14px;">
        <!-- GÃ©nÃ©rÃ© dynamiquement -->
      </div>

      <!-- TABS CARTE / LISTE -->
      <div style="display:flex; gap:6px; margin-bottom:14px; border-bottom:2px solid rgba(148,163,184,0.2);">
        <button id="tabCarte" class="search-tab active" type="button">
          ğŸ—ºï¸ CARTE
        </button>
        <button id="tabListe" class="search-tab" type="button">
          ğŸ“‹ LISTE
        </button>
      </div>

      <!-- Status + Loader -->
      <div id="sp_status" style="color:#cbd5e1; font-weight:700; margin:10px 2px 14px; display:flex; justify-content:space-between; align-items:center;">
        <span>â€”</span>
        <div id="sp_loader" style="display:none;">
          <div style="width:20px; height:20px; border:3px solid rgba(249,115,22,0.3); border-top-color:#f97316; border-radius:50%; animation:spin 0.8s linear infinite;"></div>
        </div>
      </div>

      <!-- PANEL CARTE -->
      <div id="panelCarte" class="search-panel active">
        <div id="mapContainer" style="height:500px; border-radius:18px; overflow:hidden; border:1px solid rgba(148,163,184,0.45); position:relative;">
          <div id="map" style="height:100%; width:100%;"></div>
          
          <!-- Bouton recentrer -->
          <button id="recenterMap" type="button" style="
            position:absolute; top:14px; right:14px; z-index:1000;
            background:rgba(15,23,42,0.95); border:1px solid rgba(148,163,184,0.6);
            color:#fff; padding:10px 14px; border-radius:12px; cursor:pointer;
            font-weight:800; font-size:0.85rem; display:flex; align-items:center; gap:6px;
            box-shadow:0 6px 20px rgba(0,0,0,0.5);">
            ğŸ“ Recentrer
          </button>

          <!-- LÃ©gende -->
          <div id="mapLegend" style="
            position:absolute; bottom:14px; left:14px; z-index:1000;
            background:rgba(15,23,42,0.95); border:1px solid rgba(148,163,184,0.6);
            padding:10px 12px; border-radius:12px; color:#cbd5e1; font-size:0.75rem;
            max-width:200px; box-shadow:0 6px 20px rgba(0,0,0,0.5);">
            <div style="font-weight:800; margin-bottom:4px;">ğŸ“ LÃ©gende</div>
            <div>ğŸŸ¢ En ligne â€¢ ğŸ”´ Hors ligne</div>
            <div>ğŸ“ Click marker â†’ Fiche PRO</div>
          </div>
        </div>
      </div>

      <!-- PANEL LISTE -->
      <div id="panelListe" class="search-panel">
        <div id="sp_results" class="digiy-results-grid"></div>

        <!-- Message vide -->
        <div id="sp_empty" style="display:none; margin-top:12px; padding:24px; border-radius:16px; border:1px dashed rgba(148,163,184,.45); color:#cbd5e1; text-align:center;">
          <div style="font-size:2.5rem; margin-bottom:8px;">ğŸ¤”</div>
          <div style="font-weight:800; margin-bottom:6px;">Aucun rÃ©sultat</div>
          <div style="font-size:0.9rem; opacity:0.8;">Essaie "Dakar", "Plateau", "chauffeur", ou un nom de pro</div>
        </div>

        <!-- Pagination -->
        <div id="sp_pagination" style="display:none; margin-top:16px; text-align:center;">
          <button id="sp_loadMore" class="btn btn-secondary" type="button" style="padding:0.7rem 1.5rem;">
            Charger plus de rÃ©sultats â†’
          </button>
        </div>
      </div>

    </div>
  </div>
</div>


  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // ğŸ” SUPABASE â€” DÃ‰JÃ€ POSÃ‰ (DIGIY)
    const SB = supabase.createClient("https://wesqmwjjtsefyjnluosj.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA");
  </script>

  <!-- Data SÃ©nÃ©gal -->
  <script src="assets/data/zones-senegal.js"></script>
  <script src="assets/data/digiy-business-database-senegal.js"></script>

  <!-- Moteur Search Pro -->
  <script src="assets/js/search-pro-map.js"></script>

  <script>
    // Modal overlay: display flex (propre)
    const __m = document.getElementById("searchProModal");
    if(__m){
      __m.style.display = "none";
    }
  </script>
</body>
</html>
