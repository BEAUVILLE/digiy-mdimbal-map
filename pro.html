<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Fiche Pro ‚Äî DIGIYLYFE ‚ôæÔ∏è</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="description" content="Fiche partenaire DIGIYLYFE ‚Äî premium, lisible, contact direct." />
  <meta name="theme-color" content="#ffffff">

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --ink:#0f172a;        /* ‚úÖ √©criture noir */
      --muted:#475569;
      --line:rgba(15,23,42,.10);

      --gold:#facc15;
      --gold2:#f59e0b;
      --green:#16a34a;
      --blue:#0ea5e9;

      --shadow:0 14px 40px rgba(2,6,23,.10);
      --shadow2:0 10px 26px rgba(2,6,23,.08);

      --r-xl:22px;
      --r-lg:18px;
      --r-md:14px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1100px 600px at 12% -8%, rgba(250,204,21,.18), transparent 55%),
        radial-gradient(900px 520px at 92% 0%, rgba(22,163,74,.12), transparent 55%),
        linear-gradient(180deg, #ffffff 0%, var(--bg) 55%, #ffffff 100%);
    }
    a{color:inherit;text-decoration:none}

    .topbar{
      position:sticky;top:0;z-index:50;
      background: rgba(255,255,255,.85);
      backdrop-filter: blur(10px) saturate(140%);
      border-bottom:1px solid var(--line);
    }
    .topbar .inner{
      max-width:1120px;margin:0 auto;
      padding:10px 14px;
      display:flex;align-items:center;gap:10px;
    }
    .brand{display:flex;align-items:center;gap:10px;min-width:0}
    .mark{
      width:38px;height:38px;border-radius:14px;
      display:grid;place-items:center;
      font-weight:1000;
      color:#111827;
      background: radial-gradient(circle at 35% 35%, rgba(250,204,21,.95), rgba(245,158,11,.75));
      box-shadow: 0 10px 26px rgba(245,158,11,.22);
      border:1px solid rgba(245,158,11,.35);
    }
    .brand .txt{min-width:0}
    .brand b{display:block;font-size:13px;letter-spacing:.2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .brand small{display:block;color:var(--muted);font-weight:750;font-size:12px}
    .spacer{flex:1}

    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      padding:10px 12px;border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.85);
      box-shadow: var(--shadow2);
      font-weight:900;
      font-size:13px;
      transition:.15s transform ease,.15s background ease,.15s border-color ease;
      white-space:nowrap;
      user-select:none;
      cursor:pointer;
    }
    .btn:hover{transform:translateY(-1px);border-color:rgba(245,158,11,.40)}
    .btn:active{transform:translateY(0)}
    .btn-dark{background:#0b1120;color:#fff;border-color:rgba(2,6,23,.2)}
    .btn-gold{
      background: linear-gradient(135deg, rgba(250,204,21,.95), rgba(245,158,11,.90));
      border-color: rgba(245,158,11,.35);
      color:#111827;
    }
    .btn-wa{
      background: linear-gradient(135deg, #25D366, #16a34a);
      border-color: rgba(22,163,74,.35);
      color:#052e16;
    }
    .btn-call{
      background: linear-gradient(135deg, rgba(14,165,233,.95), rgba(59,130,246,.88));
      border-color: rgba(59,130,246,.35);
      color:#06151f;
    }

    .wrap{max-width:1120px;margin:0 auto;padding:14px 14px 44px}

    .hero{
      margin-top:14px;
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--r-xl);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .media{
      position:relative;
      height:340px;
      background:#0b1120;
    }
    .media img{
      width:100%;height:100%;
      object-fit:cover;
      object-position: center var(--focusY, 28%); /* ‚úÖ centrer */
      display:block;
      filter:saturate(1.05) contrast(1.05);
    }
    .shade{
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(2,6,23,.05) 0%, rgba(2,6,23,.40) 62%, rgba(2,6,23,.62) 100%);
      pointer-events:none;
    }

    .heroBody{
      padding:14px 14px 16px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:12px;
      align-items:start;
    }
    .title{margin:0;font-size:28px;font-weight:1000;letter-spacing:.2px}
    .subtitle{margin:8px 0 0;color:var(--muted);font-weight:800;line-height:1.45}

    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      border:1px solid rgba(2,6,23,.10);
      background: rgba(250,204,21,.12);
      color:#0f172a;
      font-weight:900;font-size:12px;
    }

    .pillCol{display:grid;gap:10px;align-content:start}
    .pill{
      display:flex;gap:10px;align-items:flex-start;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(2,6,23,.10);
      background: rgba(255,255,255,.95);
      box-shadow: 0 10px 22px rgba(2,6,23,.06);
    }
    .pill b{display:block;font-size:13px}
    .pill small{display:block;color:var(--muted);font-weight:800;margin-top:2px;line-height:1.35}

    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:14px;
    }
    .card{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--r-xl);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:12px 14px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(250,204,21,.10), transparent);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .card .hd b{font-size:14px;letter-spacing:.2px}
    .card .bd{padding:12px 14px}

    .item{
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(2,6,23,.08);
      background: rgba(2,6,23,.02);
      margin-bottom:10px;
    }
    .item .t{font-weight:950}
    .item .s{color:var(--muted);font-weight:800;margin-top:6px;line-height:1.65}

    .gallery{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    .ph{
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(2,6,23,.10);
      aspect-ratio: 4 / 3;
      background:#eef2ff;
      position:relative;
    }
    .ph img{width:100%;height:100%;object-fit:cover;display:block}
    .ph::after{
      content:""; position:absolute; inset:0;
      background: linear-gradient(180deg, transparent 55%, rgba(2,6,23,.22));
      pointer-events:none;
    }

    .note{
      margin-top:10px;
      padding:12px 12px;
      border-radius:16px;
      border:1px dashed rgba(245,158,11,.45);
      background: rgba(250,204,21,.14);
      color:#111827;
      font-weight:900;
      line-height:1.55;
    }

    .mapEmbed{
      width:100%;
      height:320px;
      border:0;
      border-radius:16px;
    }

    .err{
      margin-top:14px;
      padding:14px 14px;
      border-radius:18px;
      border:1px solid rgba(239,68,68,.35);
      background: rgba(239,68,68,.10);
      color:#7f1d1d;
      font-weight:900;
      white-space:pre-line;
    }

    .foot{
      margin-top:16px;
      text-align:center;
      color: rgba(15,23,42,.55);
      font-weight:900;
      font-size:12px;
    }

    @media (max-width: 980px){
      .heroBody{grid-template-columns:1fr}
      .grid{grid-template-columns:1fr}
      .media{height:280px}
    }
    @media (max-width: 560px){
      .media{height:240px}
      .gallery{grid-template-columns:repeat(2,1fr)}
      .btn{flex:1}
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="inner">
      <a class="btn" href="./index.html">üó∫Ô∏è NDIMBAL Map</a>

      <div class="brand">
        <div class="mark">‚àû</div>
        <div class="txt">
          <b id="brandTitle">DIGIYLYFE ¬∑ Fiche Premium</b>
          <small id="brandSub">Contact direct ¬∑ 0% commission</small>
        </div>
      </div>

      <div class="spacer"></div>

      <a class="btn" href="https://digiylyfe.com/page-partenaires/" target="_blank" rel="noopener">üîé Moteur</a>
      <a class="btn btn-gold" href="https://beauville.github.io/digiy-hub/" target="_blank" rel="noopener">üè† HUB</a>
    </div>
  </div>

  <div class="wrap">
    <div id="errorBox" class="err" style="display:none"></div>

    <section class="hero" aria-label="Fiche partenaire">
      <div class="media">
        <img id="coverImg" alt="Couverture partenaire" loading="eager" decoding="async" />
        <div class="shade"></div>
      </div>

      <div class="heroBody">
        <div>
          <h1 class="title" id="proName">‚Äî</h1>
          <div class="subtitle" id="proSubtitle">‚Äî</div>

          <div class="chips" id="chips"></div>
        </div>

        <div class="pillCol">
          <div class="pill">
            <div>‚ö°</div>
            <div>
              <b>Contact direct</b>
              <small>WhatsApp / Appel</small>
              <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
                <a class="btn btn-wa" id="btnWA" href="#" target="_blank" rel="noopener">üí¨ WhatsApp</a>
                <a class="btn btn-call" id="btnCall" href="#">üìû Appeler</a>
              </div>
            </div>
          </div>

          <div class="pill">
            <div>üß≠</div>
            <div>
              <b>Localisation</b>
              <small id="locText">‚Äî</small>
              <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
                <a class="btn btn-dark" id="btnMaps" href="#" target="_blank" rel="noopener">üó∫Ô∏è Google Maps</a>
                <a class="btn" id="btnRoute" href="#" target="_blank" rel="noopener">üß≠ Itin√©raire</a>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <section class="grid">
      <article class="card">
        <div class="hd"><b>üßæ Pr√©sentation</b><span class="chip">‚úÖ Valid√© DIGIY</span></div>
        <div class="bd">
          <div class="item">
            <div class="t">Description</div>
            <div class="s" id="proDesc">‚Äî</div>
          </div>

          <div class="item" id="servicesBox" style="display:none">
            <div class="t">Services</div>
            <div class="s" id="proServices">‚Äî</div>
          </div>

          <div class="item" id="hoursBox" style="display:none">
            <div class="t">Horaires</div>
            <div class="s" id="proHours">‚Äî</div>
          </div>

          <div class="note">
            üíé Astuce premium : envoie une photo / une id√©e sur WhatsApp ‚Äî le pro te propose le bon combo.
          </div>
        </div>
      </article>

      <aside class="card">
        <div class="hd"><b>üì∏ Galerie</b><span style="color:var(--muted);font-weight:900;font-size:12px" id="slugPill">‚Äî</span></div>
        <div class="bd">
          <div class="gallery" id="gallery"></div>
          <div style="height:10px"></div>
          <iframe class="mapEmbed" id="mapEmbed" loading="lazy" title="Carte Google Maps"></iframe>
        </div>
      </aside>
    </section>

    <div class="foot">¬© DIGIYLYFE ¬∑ 0% commission ¬∑ Paiement direct au pro ¬∑ ‚àû</div>
  </div>

<script>
/* ================================
   SUPABASE (tes cl√©s)
================================ */
const SUPABASE_URL = "https://wesqmwjjtsefyjnluosj.supabase.co";
const SUPABASE_ANON_KEY =
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";
const SB = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const $ = (id)=>document.getElementById(id);
const DEFAULT_SLUG = "astou-boutique";

/* ================================
   helpers
================================ */
function safe(v, fb=""){
  return (v==null?fb:String(v)).trim();
}
function fold(s){
  return (s||'').toString().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');
}
function normCategory(cat){
  const c = fold(cat);
  if(c.includes('resto') || c.includes('restaurant')) return 'restaurant';
  if(c.includes('commerce') || c.includes('market') || c.includes('boutique')) return 'commerce';
  if(c.includes('logement') || c.includes('heberg') || c.includes('h√©berg') || c.includes('villa')) return 'logement';
  if(c.includes('hotel') || c.includes('h√¥tel')) return 'hotel';
  if(c.includes('taxi') || c.includes('vtc') || c.includes('driver') || c.includes('chauffeur')) return 'taxi';
  if(c.includes('bat') || c.includes('b√¢t') || c.includes('construction') || c.includes('artisan')) return 'batiment';
  if(c.includes('voyage') || c.includes('explore') || c.includes('guide')) return 'voyage';
  if(c.includes('loisir')) return 'loisir';
  if(c.includes('notable')) return 'notable';
  return cat ? 'commerce' : '';
}
function catEmoji(c){
  const m = {
    commerce:"üè™", restaurant:"üçΩÔ∏è", logement:"üè†", taxi:"üöï", hotel:"üè®",
    batiment:"üî®", voyage:"‚úàÔ∏è", loisir:"üé≠", notable:"üëî"
  };
  return m[c] || "üìç";
}
function parseSlug(){
  const u = new URL(location.href);
  let slug = (u.searchParams.get("slug") || "").trim();
  if(!slug){
    const h = (location.hash || "").replace("#","").trim();
    if(h) slug = h;
  }
  return slug;
}
function isUrl(s){
  try{ new URL(s); return true; }catch(e){ return false; }
}
function joinList(val){
  if(!val) return "";
  if(Array.isArray(val)) return val.filter(Boolean).join(" ¬∑ ");
  if(typeof val === "string") return val;
  if(typeof val === "object"){
    const entries = Object.entries(val).filter(([k,v])=>v!=null && String(v).trim()!=="");
    return entries.map(([k,v])=>`${k}: ${v}`).join(" ¬∑ ");
  }
  return String(val);
}
function buildWA(phone, name){
  const p = String(phone||"").replace(/\s+/g,'');
  if(!p) return "";
  const msg = encodeURIComponent(`Salam ${name || ""} ‚Äî je viens de DIGIYLYFE ‚ôæÔ∏è`);
  const cleaned = p.replace(/^00/,'+');
  const digits = cleaned.startsWith("+") ? cleaned.slice(1) : cleaned;
  return `https://wa.me/${digits}?text=${msg}`;
}
function mapsSearch(name, city){
  const q = encodeURIComponent([name, city].filter(Boolean).join(" "));
  return "https://www.google.com/maps/search/?api=1&query=" + q;
}
function mapsDir(name, city){
  const q = encodeURIComponent([name, city].filter(Boolean).join(" "));
  return "https://www.google.com/maps/dir/?api=1&destination=" + q;
}
function mapsEmbed(name, city){
  const q = encodeURIComponent([name, city].filter(Boolean).join(" "));
  return "https://www.google.com/maps?q=" + q + "&output=embed";
}

function showError(msg){
  $("errorBox").style.display = "block";
  $("errorBox").textContent = msg;
}

/* ================================
   data
================================ */
async function loadPro(slug){
  const { data, error } = await SB
    .from("professionals")
    .select("*")
    .eq("slug", slug)
    .maybeSingle();

  if(error) throw new Error("Supabase: " + error.message);
  if(!data) throw new Error("Aucun partenaire trouv√© pour le slug : " + slug);
  return data;
}

function renderPro(p, slugUsed){
  const name = safe(p.name, "Partenaire DIGIY");
  const city = safe(p.city, "S√©n√©gal");
  const zone = safe(p.zone, "");
  const catRaw = safe(p.category, "");
  const cat = normCategory(catRaw);

  $("proName").textContent = name;
  $("proSubtitle").textContent = [catRaw, zone, city].filter(Boolean).join(" ¬∑ ") || "Partenaire local";
  $("brandTitle").textContent = "DIGIYLYFE ¬∑ " + name;
  $("slugPill").textContent = "‚ôæÔ∏è " + safe(p.slug, slugUsed);

  // chips
  const chips = $("chips");
  chips.innerHTML = "";
  const base = [
    `${catEmoji(cat)} ${catRaw || "Service"}`,
    `üìç ${city}${zone ? " ¬∑ " + zone : ""}`
  ];
  if(p.badge_text) base.push(`üè∑Ô∏è ${safe(p.badge_text)}`);
  if(p.price_text) base.push(`üí∞ ${safe(p.price_text)}`);
  base.forEach(t=>{
    const s = document.createElement("span");
    s.className = "chip";
    s.textContent = t;
    chips.appendChild(s);
  });

  // cover
  const cover = (p.cover_url && isUrl(p.cover_url)) ? p.cover_url : "";
  $("coverImg").src = cover || ("data:image/svg+xml;charset=utf-8," + encodeURIComponent(
    `<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='700'>
      <defs>
        <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
          <stop stop-color='#facc15' stop-opacity='.24'/>
          <stop offset='1' stop-color='#16a34a' stop-opacity='.14'/>
        </linearGradient>
      </defs>
      <rect width='100%' height='100%' fill='#0b1120'/>
      <rect width='100%' height='100%' fill='url(#g)'/>
      <text x='50%' y='52%' text-anchor='middle' fill='#111827' font-family='system-ui' font-size='46' font-weight='900'>${name.replace(/</g,"&lt;")}</text>
      <text x='50%' y='62%' text-anchor='middle' fill='#334155' font-family='system-ui' font-size='22' font-weight='800'>DIGIYLYFE ¬∑ 0% commission</text>
    </svg>`
  ));

  // ‚úÖ centrage sp√©cial Astou (tu peux ajouter d‚Äôautres cas)
  if(safe(p.slug) === "astou-boutique"){
    document.documentElement.style.setProperty("--focusY", "28%");
  }else{
    document.documentElement.style.setProperty("--focusY", "35%");
  }

  // desc
  $("proDesc").textContent = safe(p.description,
    "Linge de maison : draps, housses, taies, serviettes, peignoirs, rideaux. " +
    "Nombreuses couleurs (pastels & vives). Collection de robes : pr√™t-√†-porter & personnalisables. " +
    "Besoin d‚Äôun conseil ? On t‚Äôaide √† choisir le bon combo ‚Äî sans blabla."
  );

  // services
  const services = joinList(p.services);
  if(services){
    $("servicesBox").style.display = "block";
    $("proServices").textContent = services;
  }

  // hours
  const hours = joinList(p.opening_hours || p.hours);
  if(hours){
    $("hoursBox").style.display = "block";
    $("proHours").textContent = hours;
  }

  // contact
  const phone = safe(p.phone, "");
  const waField = safe(p.whatsapp, "");
  const phoneToUse = waField || phone;

  const wa = buildWA(phoneToUse, name);
  $("btnWA").href = wa || "#";
  $("btnWA").onclick = (e)=>{ if(!wa){ e.preventDefault(); alert("WhatsApp indisponible (num√©ro manquant)"); } };

  $("btnCall").href = phoneToUse ? `tel:${phoneToUse.replace(/\s+/g,"")}` : "#";
  $("btnCall").onclick = (e)=>{ if(!phoneToUse){ e.preventDefault(); alert("Num√©ro non disponible"); } };

  $("locText").textContent = `${city}${zone ? " ¬∑ " + zone : ""}`;

  const maps1 = mapsSearch(name, city);
  const maps2 = mapsDir(name, city);

  $("btnMaps").href = maps1;
  $("btnRoute").href = maps2;

  $("mapEmbed").src = mapsEmbed(name, city);

  // gallery : si pas de photos en DB -> set premium par d√©faut pour Astou
  let photos = p.photos || p.gallery || p.images;
  if(typeof photos === "string"){
    try{ photos = JSON.parse(photos); }catch(e){}
  }
  let urls = [];
  if(Array.isArray(photos)){
    urls = photos.filter(u=>typeof u==="string" && u.trim() && isUrl(u.trim())).slice(0, 12);
  }

  // fallback premium coh√©rent (linge/robes) si vide
  if(!urls.length){
    urls = [
      "https://digiylyfe.com/wp-content/uploads/2025/06/ASTOU-BOUTIK.png",
      "https://images.unsplash.com/photo-1759264244764-2cb80f1a67bd?fm=jpg&ixlib=rb-4.1.0&q=80&w=1600",
      "https://images.unsplash.com/photo-1635353059173-461b9c459f2a?fm=jpg&ixlib=rb-4.1.0&q=80&w=1600",
      "https://images.unsplash.com/photo-1762834923135-f125e65b88eb?fm=jpg&ixlib=rb-4.1.0&q=80&w=1600",
      "https://images.unsplash.com/photo-1761090617068-f1b3257d27ad?fm=jpg&ixlib=rb-4.1.0&q=80&w=1600"
    ];
  }

  const g = $("gallery");
  g.innerHTML = "";
  urls.slice(0, 9).forEach(u=>{
    const a = document.createElement("a");
    a.className = "ph";
    a.href = u;
    a.target = "_blank";
    a.rel = "noopener";
    const img = document.createElement("img");
    img.src = u;
    img.alt = "Photo";
    a.appendChild(img);
    g.appendChild(a);
  });

  document.title = `${name} ‚Äî DIGIYLYFE ‚ôæÔ∏è`;
}

/* ================================
   boot
================================ */
(async function boot(){
  try{
    const slug = parseSlug();
    const finalSlug = slug || DEFAULT_SLUG;
    const pro = await loadPro(finalSlug);
    renderPro(pro, finalSlug);
  }catch(err){
    showError(
      "Impossible de charger la fiche.\n" +
      "‚Ä¢ V√©rifie que le slug existe dans Supabase.\n" +
      "‚Ä¢ V√©rifie que la table s‚Äôappelle bien 'professionals' et que la colonne 'slug' est remplie.\n" +
      "‚Ä¢ V√©rifie que RLS n‚Äôemp√™che pas le SELECT public.\n\n" +
      "D√©tail: " + (err?.message || err)
    );
  }
})();
</script>
</body>
</html>
